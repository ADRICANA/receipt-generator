<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>维修检查收据</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- 引入Google字体 -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- 引入Font Awesome图标库 -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        /* 使用CSS变量统一管理颜色和字体大小 */
        :root {
            --primary-color: #2C3E50;
            --secondary-color: #34495E;
            --accent-color: #2980B9;
            --highlight-color: #ECF0F1;
            --font-family: 'Roboto', sans-serif;
            --title-font-size: 32px;
            --heading-font-size: 24px;
            --text-font-size: 16px;
            --animation-duration: 0.3s;
        }

        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            background-color: var(--highlight-color);
            overflow-x: hidden;
            color: var(--primary-color);
        }

        .receipt-container {
            max-width: 800px;
            margin: 40px auto;
            padding: 30px;
            background-color: #fff;
            box-sizing: border-box;
            position: relative;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            animation: fadeIn var(--animation-duration) ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Logo Styling */
        .logo {
            text-align: center;
            margin-bottom: 20px;
        }

        .logo img {
            max-width: 200px;
            height: auto;
            transition: transform var(--animation-duration);
        }

        .logo img:hover {
            transform: scale(1.05);
        }

        .receipt-title {
            font-size: var(--title-font-size);
            font-weight: bold;
            color: var(--accent-color);
            margin-bottom: 30px;
            text-align: center;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .date-section {
            font-size: var(--text-font-size);
            margin-bottom: 20px;
            color: var(--primary-color);
            text-align: right;
        }

        .company-info {
            text-align: center;
            margin-bottom: 30px;
        }

        .company-info p {
            margin: 5px 0;
            font-size: var(--text-font-size);
            color: var(--secondary-color);
            line-height: 1.5;
        }

        .company-info a {
            color: var(--accent-color);
            text-decoration: none;
        }

        .section {
            margin-bottom: 30px;
            text-align: left;
            width: 100%;
            animation: slideIn var(--animation-duration) ease-in-out;
        }

        @keyframes slideIn {
            from { opacity: 0; transform: translateX(-20px); }
            to { opacity: 1; transform: translateX(0); }
        }

        .section h3 {
            font-size: var(--heading-font-size);
            color: var(--accent-color);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 5px;
            position: relative;
        }

        .section-content {
            background-color: #FAFAFA;
            padding: 20px;
            border-radius: 8px;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.05);
        }

        .section-content p {
            margin: 10px 0;
            font-size: var(--text-font-size);
            color: var(--primary-color);
            word-wrap: break-word;
            font-weight: 500;
            line-height: 1.6;
        }

        /* Machine Data Styles */
        .machine-data-items {
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .machine-data-card {
            width: 48%;
            box-sizing: border-box;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            background-color: #FFFFFF;
            padding: 15px;
            border-radius: 8px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.05);
            transition: transform var(--animation-duration);
        }

        .machine-data-card:hover {
            transform: translateY(-5px);
        }

        .machine-data-icon {
            font-size: 36px;
            color: var(--accent-color);
            margin-right: 15px;
        }

        .machine-data-details h4 {
            margin: 0 0 5px;
            font-size: 18px;
            color: var(--primary-color);
        }

        .machine-data-details p {
            margin: 0;
            color: var(--secondary-color);
        }

        /* Signature Section */
        .signature {
            margin-top: 40px;
            text-align: left;
            font-size: var(--text-font-size);
            position: relative;
        }

        .signature h3 {
            font-size: var(--heading-font-size);
            color: var(--accent-color);
            margin-bottom: 15px;
            border-bottom: 2px solid var(--accent-color);
            padding-bottom: 5px;
            position: relative;
        }

        .signature-image {
            margin-top: 20px;
            text-align: left;
            background-color: #FAFAFA;
            padding: 20px;
            border-radius: 8px;
        }

        .signature-image img {
            max-width: 100%;
            height: auto;
            border: 1px solid #ccc;
        }

        /* Footer */
        .footer {
            margin-top: 40px;
            text-align: center;
            font-size: 14px;
            color: var(--secondary-color);
            position: relative;
        }

        .footer p {
            margin: 0;
        }

        /* Buttons */
        #show-form-btn {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px;
            background-color: var(--accent-color);
            color: #fff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: background-color var(--animation-duration), transform var(--animation-duration);
        }

        #show-form-btn:hover {
            background-color: #1A73E8;
            transform: translateY(-3px);
        }

        #print-btn {
            position: fixed;
            bottom: 80px;
            right: 20px;
            padding: 15px;
            background-color: #2ecc71;
            color: #fff;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 24px;
            z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.2);
            transition: background-color var(--animation-duration), transform var(--animation-duration);
        }

        #print-btn:hover {
            background-color: #27ae60;
            transform: translateY(-3px);
        }

        /* Form Container */
        #form-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(5px);
            z-index: 1500;
            overflow-y: auto;
        }

        #form-container form {
            background-color: #fff;
            padding: 20px;
            margin: 50px auto;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.1);
            overflow-y: auto;
            max-height: 90%;
            box-sizing: border-box;
            animation: fadeInUp var(--animation-duration) ease-in-out;
        }

        @keyframes fadeInUp {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        #form-container h2 {
            margin-top: 0;
            color: var(--accent-color);
            text-align: center;
            font-weight: 700;
        }

        #form-container label {
            display: block;
            margin: 15px 0 5px;
            font-weight: 600;
            color: var(--primary-color);
        }

        #form-container input,
        #form-container textarea {
            width: 100%;
            padding: 12px;
            margin-bottom: 15px;
            border: 1px solid #ccc;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: var(--text-font-size);
            transition: border-color var(--animation-duration);
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }

        #form-container input:focus,
        #form-container textarea:focus {
            border-color: var(--accent-color);
            outline: none;
            box-shadow: 0 0 0 2px rgba(41, 128, 185, 0.2);
        }

        #form-container button {
            margin-top: 20px;
            padding: 12px 20px;
            background-color: var(--accent-color);
            color: #fff;
            border: none;
            cursor: pointer;
            border-radius: 8px;
            font-size: var(--text-font-size);
            transition: background var(--animation-duration);
            display: inline-block;
            width: auto;
        }

        #form-container button:hover {
            background-color: #1A73E8;
        }

        /* Progress Indicator */
        .progress-indicator {
            text-align: center;
            margin-bottom: 20px;
        }

        .progress-indicator span {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #ccc;
            border-radius: 50%;
            margin: 0 5px;
        }

        .progress-indicator .active {
            background-color: var(--accent-color);
            width: 12px;
            height: 12px;
            margin: 0 8px;
        }

        /* Machine Data Input Styles */
        .machine-data-item {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            border-radius: 8px;
            background-color: #f9f9f9;
        }

        .machine-data-input {
            display: flex;
            flex-wrap: wrap;
            width: 100%;
        }

        .machine-data-input label {
            width: 100%;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .machine-data-input input {
            width: calc(50% - 10px);
            margin-right: 10px;
            margin-bottom: 10px;
        }

        .remove-machine-data-btn {
            background-color: transparent;
            border: none;
            color: #FF6B6B;
            cursor: pointer;
            font-size: 24px;
            margin-left: 10px;
            transition: color var(--animation-duration);
        }

        .remove-machine-data-btn:hover {
            color: #FF4757;
        }

        /* Print Styles */
        @media print {
            body {
                background-color: #fff;
            }
            #show-form-btn, #print-btn, #language-selector {
                display: none;
            }
            .receipt-container {
                box-shadow: none;
                margin: 0;
                width: 100%;
            }
            /* 防止分页符分割重要内容 */
            .receipt-container, .section, .section-content, .company-info, .signature {
                page-break-inside: avoid;
            }
        }

        /* Responsive Adjustments */
        @media screen and (max-width: 600px) {
            .receipt-title {
                font-size: 24px;
            }

            .section h3 {
                font-size: 18px;
            }

            #form-container form {
                margin: 20px auto;
                padding: 15px;
            }

            #show-form-btn, #print-btn {
                padding: 12px;
                font-size: 18px;
            }

            .logo img {
                max-width: 80%;
            }

            .machine-data-card {
                width: 100%;
            }

            .machine-data-input input {
                width: 100%;
                margin-right: 0;
            }
        }

        /* Language Selector */
        #language-selector {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
        }

        #language-selector select {
            padding: 8px;
            font-size: var(--text-font-size);
            border: 1px solid #ccc;
            border-radius: 8px;
            background-color: #fff;
            cursor: pointer;
        }

        /* Signature Canvas Styles */
        #signature-canvas {
            border: 1px solid #ccc;
            border-radius: 8px;
            width: 100%;
            height: 200px;
            touch-action: none;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow-y: auto;
            background-color: rgba(0,0,0,0.5);
            backdrop-filter: blur(5px);
        }

        .modal-content {
            background-color: #fff;
            margin: 50px auto;
            padding: 20px;
            width: 90%;
            max-width: 600px;
            border-radius: 12px;
            position: relative;
            animation: dropIn var(--animation-duration) ease-in-out;
        }

        @keyframes dropIn {
            from {opacity: 0; transform: translateY(-20px);}
            to {opacity: 1; transform: translateY(0);}
        }

        .close-modal {
            color: #aaa;
            position: absolute;
            top: 10px;
            right: 20px;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close-modal:hover,
        .close-modal:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }

    </style>
</head>
<body>

<!-- 语言选择器 -->
<div id="language-selector">
    <select id="language-select">
        <option value="en">English</option>
        <option value="zh-Hans" selected>简体中文</option>
        <option value="zh-Hant">繁體中文</option>
    </select>
</div>

<div class="receipt-container" id="receipt-container">
    <!-- Logo Section -->
    <div class="logo">
        <img src="https://static.wixstatic.com/media/c0babf_869d1379fd57425893fbeb7057f21868~mv2.png/v1/fill/w_492,h_178,al_c,q_85,usm_0.66_1.00_0.01,enc_auto/Phoelia%20Logo.png" alt="Company Logo">
    </div>

    <!-- Title -->
    <h1 class="receipt-title" data-i18n="receipt_title"></h1>

    <!-- Date and Receipt Number Section -->
    <div class="date-section">
        <span data-i18n="date_label"></span><span id="receipt-date"></span><br>
        <span data-i18n="receipt_number_label"></span><span id="receipt-number"></span>
    </div>

    <!-- Company Information -->
    <div class="company-info">
        <p><strong data-i18n="company_label"></strong> Phoelia (Far East) Co., Ltd.</p>
        <p><strong data-i18n="address_label"></strong> Unit 4, 1/F, Fu Hang Industrial Building, 1 Hok Yuen Street East, Hung Hom, Kowloon, HONG KONG</p>
        <p>
            <i class="fas fa-phone-alt"></i> (852) 2333 9698 &nbsp;&nbsp;&nbsp;
            <i class="fas fa-envelope"></i> <a href="mailto:info@phoelia.com">info@phoelia.com</a>
        </p>
    </div>

    <!-- Inspection Information -->
    <div class="section inspection-info">
        <h3 data-i18n="inspection_info_title"></h3>
        <div class="section-content">
            <p><strong data-i18n="serial_number_label"></strong> <span id="machine-serial-number"></span></p>
            <p><strong data-i18n="inspection_date_label"></strong> <span id="inspection-date"></span></p>
            <p><strong data-i18n="shop_name_label"></strong> <span id="shop-name"></span></p>
            <p><strong data-i18n="shop_address_label"></strong> <span id="shop-address"></span></p>
        </div>
    </div>

    <!-- Machine Data -->
    <div class="section machine-data-section">
        <h3 data-i18n="machine_data_title"></h3>
        <div id="machine-data-items" class="machine-data-items">
            <!-- Machine data items will be populated here -->
        </div>
    </div>

    <!-- Special Notes -->
    <div class="section notes-section">
        <h3 data-i18n="special_notes_title"></h3>
        <div class="section-content">
            <p id="special-notes"></p>
        </div>
    </div>

    <!-- Remarks -->
    <div class="section remarks-section">
        <h3 data-i18n="remarks_title"></h3>
        <div class="section-content">
            <p id="remarks"></p>
        </div>
    </div>

    <!-- Responsible Staff -->
    <div class="section staff-section">
        <h3 data-i18n="staff_title"></h3>
        <div class="section-content">
            <p id="responsible-staff"></p>
        </div>
    </div>

    <!-- Customer Signature -->
    <div class="signature">
        <h3 data-i18n="customer_signature_title"></h3>
        <div class="signature-image" id="signature-image-container">
            <!-- Signature image will be displayed here -->
        </div>
    </div>

    <!-- Footer -->
    <div class="footer">
        <p data-i18n="footer_text"></p>
    </div>
</div>

<!-- Show form button -->
<button id="show-form-btn" aria-label=""><i class="fas fa-edit"></i></button>

<!-- Print button -->
<button id="print-btn" onclick="window.print()" aria-label=""><i class="fas fa-print"></i></button>

<!-- Hidden Form (Data Entry) -->
<div id="form-container" style="display: none;">
    <form id="data-entry-form">
        <h2 data-i18n="input_data_title"></h2>

        <!-- Progress Indicator -->
        <div class="progress-indicator">
            <span id="progress-1" class="active"></span>
            <span id="progress-2"></span>
            <span id="progress-3"></span>
        </div>

        <!-- Step 1: Inspection Information -->
        <div class="form-step" id="step-1">
            <label for="machine-serial-number-input" data-i18n="serial_number_label"></label>
            <input type="text" id="machine-serial-number-input" required pattern="[A-Za-z0-9]+">

            <label for="inspection-date-input" data-i18n="inspection_date_label"></label>
            <input type="date" id="inspection-date-input" required max="">

            <label for="shop-name-input" data-i18n="shop_name_label"></label>
            <input type="text" id="shop-name-input" required>

            <label for="shop-address-input" data-i18n="shop_address_label"></label>
            <input type="text" id="shop-address-input" required>

            <!-- Responsible Staff -->
            <label for="responsible-staff-input" data-i18n="staff_label"></label>
            <input type="text" id="responsible-staff-input" required>

            <div id="form-navigation">
                <button type="button" onclick="nextStep()" aria-label="" data-i18n="next_step"></button>
            </div>
        </div>

        <!-- Step 2: Machine Data -->
        <div class="form-step" id="step-2" style="display:none;">
            <h3 data-i18n="machine_data_title"></h3>
            <button type="button" class="add-machine-data-btn" onclick="addMachineData()" data-i18n="add_data"></button>

            <div id="machine-data-inputs">
                <!-- 动态添加的机身数据输入项 -->
            </div>

            <div id="form-navigation">
                <button type="button" onclick="prevStep()" aria-label="" data-i18n="previous_step"></button>
                <button type="button" onclick="nextStep()" aria-label="" data-i18n="next_step"></button>
            </div>
        </div>

        <!-- Step 3: Notes, Remarks, Signature -->
        <div class="form-step" id="step-3" style="display:none;">
            <label for="special-notes-input" data-i18n="special_notes_label"></label>
            <textarea id="special-notes-input" rows="4"></textarea>

            <label for="remarks-input" data-i18n="remarks_label"></label>
            <textarea id="remarks-input" rows="4"></textarea>

            <!-- Customer Signature -->
            <label data-i18n="customer_signature_label"></label>
            <button type="button" id="open-signature-pad" data-i18n="add_signature"></button>
            <div id="signature-preview" style="margin-top: 15px;">
                <!-- Signature preview will be displayed here -->
            </div>

            <div id="form-navigation">
                <button type="button" onclick="prevStep()" aria-label="" data-i18n="previous_step"></button>
                <button type="submit" aria-label="" data-i18n="generate_receipt"></button>
            </div>
            <button id="clear-form-btn" type="button" onclick="clearForm()" aria-label="" data-i18n="clear_form"></button>
        </div>
    </form>
</div>

<!-- Signature Pad Modal -->
<div id="signature-modal" class="modal">
    <div class="modal-content">
        <span class="close-modal">&times;</span>
        <h2 data-i18n="signature_modal_title"></h2>
        <canvas id="signature-canvas"></canvas>
        <div style="text-align: center;">
            <button type="button" id="save-signature" data-i18n="save_signature"></button>
            <button type="button" id="clear-signature" data-i18n="clear"></button>
        </div>
    </div>
</div>

<script>
    // JavaScript代码

    // 语言包
    const translations = {
        'en': {
            'receipt_title': 'Maintenance Inspection Receipt',
            'date_label': 'Date: ',
            'receipt_number_label': 'Receipt Number: ',
            'company_label': 'Company: ',
            'address_label': 'Address: ',
            'inspection_info_title': 'Inspection Information',
            'serial_number_label': 'Machine Serial Number: ',
            'inspection_date_label': 'Inspection Date: ',
            'shop_name_label': 'Shop Name: ',
            'shop_address_label': 'Shop Address: ',
            'staff_label': 'Responsible Staff: ',
            'staff_title': 'Responsible Staff',
            'machine_data_title': 'Machine Data',
            'special_notes_title': 'Special Notes',
            'special_notes_label': 'Special Notes: ',
            'remarks_title': 'Remarks',
            'remarks_label': 'Remarks: ',
            'customer_signature_title': 'Customer Signature',
            'customer_signature_label': 'Customer Signature: ',
            'footer_text': 'Thank you for choosing Phoelia (Far East) Co., Ltd. If you have any questions, please feel free to contact us.',
            'input_data_title': 'Input Data',
            'next_step': 'Next',
            'previous_step': 'Previous',
            'add_data': 'Add Data',
            'add_signature': 'Add Signature',
            'generate_receipt': 'Generate Receipt',
            'clear_form': 'Clear Form',
            'signature_modal_title': 'Please Sign Below',
            'save_signature': 'Save Signature',
            'clear': 'Clear',
            'print_receipt': 'Print Receipt',
            'input_data': 'Input Data',
            'input_data_aria_label': 'Input Data',
            'print_receipt_aria_label': 'Print Receipt',
            'data_description': 'Data Description',
            'data_value': 'Value',
            'signature_added': 'Signature Added.',
            'signature_required': 'Please provide a signature.',
            'receipt_generated': 'Receipt has been successfully generated!',
            'form_cleared': 'Form has been cleared.'
        },
        'zh-Hans': {
            'receipt_title': '维修检查收据',
            'date_label': '日期：',
            'receipt_number_label': '收据编号：',
            'company_label': '公司：',
            'address_label': '地址：',
            'inspection_info_title': '检查信息',
            'serial_number_label': '机身序列号：',
            'inspection_date_label': '检查日期：',
            'shop_name_label': '店铺名称：',
            'shop_address_label': '店铺地址：',
            'staff_label': '负责职员：',
            'staff_title': '负责职员',
            'machine_data_title': '机身数据',
            'special_notes_title': '特别说明',
            'special_notes_label': '特别说明：',
            'remarks_title': '备注',
            'remarks_label': '备注：',
            'customer_signature_title': '客户签名',
            'customer_signature_label': '客户签名：',
            'footer_text': '感谢您选择 Phoelia (Far East) Co., Ltd。如有任何疑问，请随时与我们联系。',
            'input_data_title': '输入数据',
            'next_step': '下一步',
            'previous_step': '上一步',
            'add_data': '添加数据',
            'add_signature': '添加签名',
            'generate_receipt': '生成收据',
            'clear_form': '清空表单',
            'signature_modal_title': '请在下面签名',
            'save_signature': '保存签名',
            'clear': '清除',
            'print_receipt': '打印收据',
            'input_data': '输入数据',
            'input_data_aria_label': '输入数据',
            'print_receipt_aria_label': '打印收据',
            'data_description': '数据描述',
            'data_value': '值',
            'signature_added': '已添加签名。',
            'signature_required': '请提供签名。',
            'receipt_generated': '收据已成功生成！',
            'form_cleared': '表单已清空。'
        },
        'zh-Hant': {
            'receipt_title': '維修檢查收據',
            'date_label': '日期：',
            'receipt_number_label': '收據編號：',
            'company_label': '公司：',
            'address_label': '地址：',
            'inspection_info_title': '檢查資訊',
            'serial_number_label': '機身序列號：',
            'inspection_date_label': '檢查日期：',
            'shop_name_label': '店鋪名稱：',
            'shop_address_label': '店鋪地址：',
            'staff_label': '負責職員：',
            'staff_title': '負責職員',
            'machine_data_title': '機身數據',
            'special_notes_title': '特別說明',
            'special_notes_label': '特別說明：',
            'remarks_title': '備註',
            'remarks_label': '備註：',
            'customer_signature_title': '客戶簽名',
            'customer_signature_label': '客戶簽名：',
            'footer_text': '感謝您選擇 Phoelia (Far East) Co., Ltd。如有任何疑問，請隨時與我們聯繫。',
            'input_data_title': '輸入數據',
            'next_step': '下一步',
            'previous_step': '上一步',
            'add_data': '添加數據',
            'add_signature': '添加簽名',
            'generate_receipt': '生成收據',
            'clear_form': '清空表單',
            'signature_modal_title': '請在下面簽名',
            'save_signature': '保存簽名',
            'clear': '清除',
            'print_receipt': '打印收據',
            'input_data': '輸入數據',
            'input_data_aria_label': '輸入數據',
            'print_receipt_aria_label': '打印收據',
            'data_description': '數據描述',
            'data_value': '值',
            'signature_added': '已添加簽名。',
            'signature_required': '請提供簽名。',
            'receipt_generated': '收據已成功生成！',
            'form_cleared': '表單已清空。'
        }
    };

    let currentLanguage = 'zh-Hans'; // 默认语言为简体中文

    function updateLanguageTexts() {
        const elements = document.querySelectorAll('[data-i18n]');
        elements.forEach(element => {
            const translationKey = element.getAttribute('data-i18n');
            if (translations[currentLanguage][translationKey]) {
                if (element.tagName.toLowerCase() === 'input' || element.tagName.toLowerCase() === 'textarea') {
                    element.placeholder = translations[currentLanguage][translationKey];
                } else {
                    element.innerText = translations[currentLanguage][translationKey];
                }
            }
        });

        // 更新按钮的 aria-label 和 title
        document.getElementById('show-form-btn').setAttribute('aria-label', translations[currentLanguage]['input_data_aria_label']);
        document.getElementById('print-btn').setAttribute('aria-label', translations[currentLanguage]['print_receipt_aria_label']);
    }

    const languageSelect = document.getElementById('language-select');
    languageSelect.value = currentLanguage;
    languageSelect.addEventListener('change', function() {
        currentLanguage = this.value;
        updateLanguageTexts();
    });

    // 初始化语言文本
    updateLanguageTexts();

    // 以下是 JavaScript 代码

    let currentStep = 1;
    const totalSteps = 3;
    let signatureDataURL = '';
    let machineDataCount = 0;
    const maxMachineDataItems = 20; // 最大的机身数据项数量

    function updateProgressIndicator() {
        for (let i = 1; i <= totalSteps; i++) {
            const progressDot = document.getElementById(`progress-${i}`);
            if (i === currentStep) {
                progressDot.classList.add('active');
            } else {
                progressDot.classList.remove('active');
            }
        }
    }

    function nextStep() {
        if (validateCurrentStep()) {
            if (currentStep < totalSteps) {
                document.getElementById(`step-${currentStep}`).style.display = 'none';
                currentStep++;
                document.getElementById(`step-${currentStep}`).style.display = 'block';
                updateProgressIndicator();
                window.scrollTo(0, 0);
            }
        }
    }

    function prevStep() {
        if (currentStep > 1) {
            document.getElementById(`step-${currentStep}`).style.display = 'none';
            currentStep--;
            document.getElementById(`step-${currentStep}`).style.display = 'block';
            updateProgressIndicator();
            window.scrollTo(0, 0);
        }
    }

    function validateCurrentStep() {
        const inputs = document.querySelectorAll(`#step-${currentStep} input[required], #step-${currentStep} textarea[required]`);
        let valid = true;
        inputs.forEach(input => {
            if (!input.checkValidity()) {
                input.reportValidity();
                valid = false;
            }
        });
        return valid;
    }

    function clearForm() {
        localStorage.clear();
        document.getElementById('data-entry-form').reset();
        signatureDataURL = '';
        document.getElementById('signature-preview').innerHTML = '';
        document.getElementById('signature-image-container').innerHTML = '';
        document.getElementById('machine-data-inputs').innerHTML = '';
        machineDataCount = 0;
        alert(translations[currentLanguage]['form_cleared']);
        currentStep = 1;
        showCurrentStep();
        updateProgressIndicator();
    }

    function saveFormData() {
        const inputs = document.querySelectorAll('#data-entry-form input, #data-entry-form textarea');
        const formData = {};
        inputs.forEach(input => {
            formData[input.id] = input.value;
        });
        formData['signatureDataURL'] = signatureDataURL;
        formData['machineData'] = getMachineDataInputs();
        localStorage.setItem('formData', JSON.stringify(formData));
    }

    function loadFormData() {
        const savedData = localStorage.getItem('formData');
        if (savedData) {
            const formData = JSON.parse(savedData);
            for (const key in formData) {
                if (formData.hasOwnProperty(key)) {
                    if (document.getElementById(key)) {
                        document.getElementById(key).value = formData[key];
                    }
                }
            }
            if (formData['signatureDataURL']) {
                signatureDataURL = formData['signatureDataURL'];
                document.getElementById('signature-preview').innerHTML = '<p>' + translations[currentLanguage]['signature_added'] + '</p>';
            }
            if (formData['machineData']) {
                formData['machineData'].forEach(dataItem => {
                    addMachineData(dataItem.description, dataItem.value);
                });
            }
        }
    }

    function showCurrentStep() {
        for (let i = 1; i <= totalSteps; i++) {
            document.getElementById(`step-${i}`).style.display = (i === currentStep) ? 'block' : 'none';
        }
    }

function addMachineData(description = '', value = '') {
    if (machineDataCount >= maxMachineDataItems) {
        alert(translations[currentLanguage]['add_data'] + ' ' + maxMachineDataItems);
        return;
    }
    const container = document.getElementById('machine-data-inputs');
    const index = machineDataCount;
    machineDataCount++;

    const dataDiv = document.createElement('div');
    dataDiv.classList.add('machine-data-item');

    const inputContainer = document.createElement('div');
    inputContainer.classList.add('machine-data-input');

    const descriptionLabel = document.createElement('label');
    descriptionLabel.textContent = translations[currentLanguage]['data_description'];
    inputContainer.appendChild(descriptionLabel);

    const descriptionInput = document.createElement('input');
    descriptionInput.type = 'text';
    descriptionInput.name = `data-description-${index}`;
    descriptionInput.placeholder = translations[currentLanguage]['data_description'];
    descriptionInput.value = description;
    descriptionInput.required = true;
    inputContainer.appendChild(descriptionInput);

    const valueLabel = document.createElement('label');
    valueLabel.textContent = translations[currentLanguage]['data_value'];
    inputContainer.appendChild(valueLabel);

    const valueInput = document.createElement('input');
    valueInput.type = 'text';
    valueInput.name = `data-value-${index}`;
    valueInput.placeholder = translations[currentLanguage]['data_value'];
    valueInput.value = value;
    valueInput.required = true;
    inputContainer.appendChild(valueInput);

    dataDiv.appendChild(inputContainer);

    const removeBtn = document.createElement('button');
    removeBtn.type = 'button';
    removeBtn.classList.add('remove-machine-data-btn');
    removeBtn.innerHTML = '&times;';
    removeBtn.addEventListener('click', () => {
        container.removeChild(dataDiv);
        machineDataCount--;
    });
    dataDiv.appendChild(removeBtn);

    container.appendChild(dataDiv);
    }

    function getMachineDataInputs() {
        const dataItems = [];
        const container = document.getElementById('machine-data-inputs');
        const items = container.getElementsByClassName('machine-data-item');
        for (let i = 0; i < items.length; i++) {
            const descriptionInput = items[i].querySelector('input[name^="data-description"]');
            const valueInput = items[i].querySelector('input[name^="data-value"]');
            if (descriptionInput && valueInput) {
                dataItems.push({
                    description: descriptionInput.value,
                    value: valueInput.value,
                });
            }
        }
        return dataItems;
    }

    // Show and hide form
    const showFormBtn = document.getElementById('show-form-btn');
    const formContainer = document.getElementById('form-container');
    const dataEntryForm = document.getElementById('data-entry-form');

    showFormBtn.addEventListener('click', () => {
        formContainer.style.display = 'block';
        document.body.classList.add('modal-open');
        loadFormData();
        window.scrollTo(0, 0);
    });

    formContainer.addEventListener('click', (e) => {
        if (e.target === formContainer) {
            formContainer.style.display = 'none';
            document.body.classList.remove('modal-open');
        }
    });

    // Close form when pressing Esc
    document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && formContainer.style.display === 'block') {
            formContainer.style.display = 'none';
            document.body.classList.remove('modal-open');
        }
    });

    // Signature Pad 代码
    const signatureModal = document.getElementById('signature-modal');
    const openSignaturePadBtn = document.getElementById('open-signature-pad');
    const closeModalBtn = document.querySelector('.close-modal');
    const saveSignatureBtn = document.getElementById('save-signature');
    const clearSignatureBtn = document.getElementById('clear-signature');
    const signatureCanvas = document.getElementById('signature-canvas');
    const signaturePreview = document.getElementById('signature-preview');
    let isDrawing = false;
    let lastX = 0;
    let lastY = 0;
    const ctx = signatureCanvas.getContext('2d');

    // Resize canvas to fit modal
    function resizeCanvas() {
        signatureCanvas.width = signatureCanvas.offsetWidth;
        signatureCanvas.height = 200;
        ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
    }

    openSignaturePadBtn.addEventListener('click', () => {
        signatureModal.style.display = 'block';
        document.body.classList.add('modal-open');
        resizeCanvas();
        ctx.strokeStyle = '#000';
        ctx.lineWidth = 2;
        ctx.lineCap = 'round';
    });

    closeModalBtn.addEventListener('click', () => {
        signatureModal.style.display = 'none';
        document.body.classList.remove('modal-open');
    });

    signatureModal.addEventListener('click', (e) => {
        if (e.target === signatureModal) {
            signatureModal.style.display = 'none';
            document.body.classList.remove('modal-open');
        }
    });

    // Drawing functions
    function getPointerPosition(e) {
        var rect = signatureCanvas.getBoundingClientRect();
        var x, y;
        if (e.type.startsWith('touch')) {
            x = e.touches[0].clientX - rect.left;
            y = e.touches[0].clientY - rect.top;
        } else {
            x = e.clientX - rect.left;
            y = e.clientY - rect.top;
        }
        return { x, y };
    }

    function startDrawing(e) {
        e.preventDefault();
        isDrawing = true;
        const pos = getPointerPosition(e);
        lastX = pos.x;
        lastY = pos.y;
    }

    function draw(e) {
        if (!isDrawing) return;
        e.preventDefault();
        const pos = getPointerPosition(e);
        ctx.beginPath();
        ctx.moveTo(lastX, lastY);
        ctx.lineTo(pos.x, pos.y);
        ctx.stroke();
        lastX = pos.x;
        lastY = pos.y;
    }

    function stopDrawing(e) {
        if (!isDrawing) return;
        e.preventDefault();
        isDrawing = false;
    }

    signatureCanvas.addEventListener('mousedown', startDrawing);
    signatureCanvas.addEventListener('mousemove', draw);
    signatureCanvas.addEventListener('mouseup', stopDrawing);
    signatureCanvas.addEventListener('mouseout', stopDrawing);

    signatureCanvas.addEventListener('touchstart', startDrawing);
    signatureCanvas.addEventListener('touchmove', draw);
    signatureCanvas.addEventListener('touchend', stopDrawing);

    clearSignatureBtn.addEventListener('click', () => {
        ctx.clearRect(0, 0, signatureCanvas.width, signatureCanvas.height);
    });

    saveSignatureBtn.addEventListener('click', () => {
        const emptyCanvas = document.createElement('canvas');
        emptyCanvas.width = signatureCanvas.width;
        emptyCanvas.height = signatureCanvas.height;

        if (signatureCanvas.toDataURL() === emptyCanvas.toDataURL()) {
            alert(translations[currentLanguage]['signature_required']);
            return;
        }

        signatureDataURL = signatureCanvas.toDataURL();
        signaturePreview.innerHTML = '<p>' + translations[currentLanguage]['signature_added'] + '</p>';
        signatureModal.style.display = 'none';
        document.body.classList.remove('modal-open');
    });

    // Populate receipt with data from form
    dataEntryForm.addEventListener('submit', (e) => {
        e.preventDefault();

        // Date
        const dateValue = document.getElementById('inspection-date-input').value;
        document.getElementById('receipt-date').textContent = new Date().toLocaleDateString();
        document.getElementById('inspection-date').textContent = dateValue;

        // Generate Receipt Number
        document.getElementById('receipt-number').textContent = generateReceiptNumber();

        // Inspection Information
        document.getElementById('machine-serial-number').textContent = document.getElementById('machine-serial-number-input').value;
        document.getElementById('shop-name').textContent = document.getElementById('shop-name-input').value;
        document.getElementById('shop-address').textContent = document.getElementById('shop-address-input').value;

        // Responsible Staff
        document.getElementById('responsible-staff').textContent = document.getElementById('responsible-staff-input').value;

        // Machine Data
        const machineDataContainer = document.getElementById('machine-data-items');
        machineDataContainer.innerHTML = '';

        const machineDataInputs = getMachineDataInputs();

        if (machineDataInputs.length === 0) {
            alert(translations[currentLanguage]['add_data'] + '。');
            return;
        }

        machineDataInputs.forEach((dataItem, index) => {
            const card = document.createElement('div');
            card.classList.add('machine-data-card');

            const icon = document.createElement('i');
            icon.className = `fas fa-cogs machine-data-icon`;
            card.appendChild(icon);

            const details = document.createElement('div');
            details.classList.add('machine-data-details');

            const title = document.createElement('h4');
            title.textContent = dataItem.description;
            details.appendChild(title);

            const valuePara = document.createElement('p');
            valuePara.textContent = dataItem.value;
            details.appendChild(valuePara);

            card.appendChild(details);

            machineDataContainer.appendChild(card);
        });

        // Special Notes and Remarks
        document.getElementById('special-notes').textContent = document.getElementById('special-notes-input').value;
        document.getElementById('remarks').textContent = document.getElementById('remarks-input').value;

        // Signature Image
        if (signatureDataURL) {
            const signatureImageContainer = document.getElementById('signature-image-container');
            signatureImageContainer.innerHTML = `<img src="${signatureDataURL}" alt="${translations[currentLanguage]['customer_signature_title']}">`;
        } else {
            alert(translations[currentLanguage]['signature_required']);
            return;
        }

        // Save form data
        saveFormData();

        // Hide form after submission
        formContainer.style.display = 'none';
        document.body.classList.remove('modal-open');

        // Show success message
        alert(translations[currentLanguage]['receipt_generated']);

        // Scroll to the top of the receipt
        window.scrollTo(0, 0);
    });

    // Initialize
    window.onload = function() {
        showCurrentStep();
        updateProgressIndicator();
        document.getElementById('receipt-date').textContent = new Date().toLocaleDateString();

        const maxDate = new Date().toISOString().split('T')[0];
        document.getElementById('inspection-date-input').setAttribute('max', maxDate);
    };

    function generateReceiptNumber() {
        // 生成一个唯一的收据编号，例如日期加随机数
        let datePart = new Date().toISOString().slice(0,10).replace(/-/g,"");
        let randomPart = Math.floor(Math.random() * 10000);
        return datePart + randomPart.toString().padStart(4, '0');
    }
</script>

</body>
</html>